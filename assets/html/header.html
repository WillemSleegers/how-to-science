<header>
  <script src="assets/js/bigfoot.min.js"></script>
  <script>
    function toggleAllCode() {
      // Find all the sourceCode elements
      const elements = document.getElementsByClassName("sourceCode")
      
      // Loop over the elements and toggle the 'hidden' class if the element
      // is a div
      for (let element of elements) {
        if (element.nodeName == "DIV") {
          if (element.classList.contains("sourceCode")) {
            element.classList.toggle("hidden")
          }  
        }
      }
      
      // Update the button text
      const button = document.getElementById("toggle-code-button")
      
      // Toggle the button's class
      button.classList.toggle("code-hidden")

      // Update the button text
      if (button.classList.contains("code-hidden")) {
        button.textContent = "Show All Code"
      } else {
        button.textContent = "Hide All Code"
      }
    }

    function toggleText() {
      // Find the foldable div this button belongs to
      const div = this.parentNode;

      // Loop over the elements and 
      for (child of div.children) {
        console.log(child)
        console.log(child.style.display)
        
        if (child.style.display === "block") {
          child.style.display = "none"
        } else {
          child.style.display = "block"
        }
        
      }

      // Toggle the text of the button
      const button = this
      console.log(this)
      if (button.textContent == "Show me less") {
        button.textContent = "Show me more"
      } else {
        button.textContent = "Show me less"
      }
    }

    

    window.onload = function() {
      // Check if there are any code sections on the page
      const codeBlocks = document.getElementsByClassName("sourceCode")
      
      // Add toggle code button, but only if there are code blocks
      if (codeBlocks.length > 0) {
        // Find the book header at the top of the page
        const header = document.getElementsByClassName("book-header").item(0)
        
        // Create a link element
        const link = document.createElement("a")
        link.className = "btn pull-left js-toolbar-action"
        link.title = "Toggle code"
        link.onclick = toggleAllCode
        
        // Create an icon element
        const icon = document.createElement("i")
        icon.className = "fa fa-code"
        
        // Add the icon to the link
        link.appendChild(icon)
      
        // Add the link to the header
        header.appendChild(link)
      }
      
      // Find all foldable sections
      const foldBlocks = document.getElementsByClassName("foldable")
      
      if (foldBlocks.length > 0) {
        // Loop over the fold blocks, check if there is a button, if so, add the
        // fold text function
        for (block of foldBlocks) {
          const button = block.getElementsByClassName("fold-button").item(0)
          
          if (button) button.onclick = toggleText
        }
      }
      
      // Initiate bigfoot to add popover footnotes
      $.bigfoot();
    }
</script>
  
</header>
